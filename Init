local environment = assert(getgenv, "<OH> ~ Your exploit is not supported")()

if oh then oh.Exit() end

local user = "Neosq" 
local branch = "main"
local importCache = {}

function environment.import(asset)
    if importCache[asset] then return unpack(importCache[asset]) end
    
    local baseUrl = "https://raw.githubusercontent.com/" .. user .. "/Hyd/" .. branch .. "/"
    
    -- Авто-исправление путей: приводим к твоему формату с Большой Буквы
    local fixedAsset = asset:gsub("^methods/", "Methods/")
                            :gsub("^objects/", "Objects/")
                            :gsub("^ui/controls/", "ui/Controls/")
                            :gsub("^ui/modules/", "ui/Modules/")

    local attempts = {
        baseUrl .. fixedAsset,
        baseUrl .. fixedAsset .. ".lua",
        baseUrl .. asset, -- на случай если путь был верным
        baseUrl .. asset .. ".lua"
    }

    local success, result
    for _, url in ipairs(attempts) do
        success, result = pcall(game.HttpGet, game, url)
        if success and result and not result:find("404") and #result > 10 then
            break 
        end
    end

    if success and result and not result:find("404") and #result > 10 then
        local f, err = loadstring(result, asset)
        if f then
            local content = { f() }
            importCache[asset] = content
            return unpack(content)
        else
            warn("<OH> Ошибка синтаксиса в " .. asset .. ": " .. err)
            error("LUA_ERR")
        end
    else
        warn("<OH> 404: Не найден " .. asset .. " | Ссылка: " .. attempts[1])
        error("HTTP_404")
    end
end

-- Инициализация системы
local globalMethods = {
    checkCaller = checkcaller, newCClosure = newcclosure, hookFunction = hookfunction or detour_function,
    getGc = getgc, getInfo = debug.getinfo, getSenv = getsenv, getMenv = getmenv,
    getConnections = get_signal_cons or getconnections, getHui = gethui or get_hidden_gui,
    setReadOnly = setreadonly, isReadOnly = isreadonly, readFile = readfile, writeFile = writefile
}

environment.oh = { Events = {}, Hooks = {}, Cache = importCache, Methods = globalMethods, Exit = function() end }

for k, v in pairs(globalMethods) do environment[k] = v end
environment.import = environment.import

-- Загрузка
import("aux")
import("Methods/string")
import("Methods/table")
import("Methods/userdata")
import("Methods/environment")
import("ui/Main")
