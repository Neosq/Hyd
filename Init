local environment = assert(getgenv, "<OH> ~ Your exploit is not supported")()

if oh then 
    oh.Exit() 
end

local user = "Neosq" 
local branch = "main"
local importCache = {}

-- Функция импорта с поддержкой исправлений путей и расширений
function environment.import(asset)
    if importCache[asset] then return unpack(importCache[asset]) end
    
    local content
    if asset:find("rbxassetid://") then
        local success, result = pcall(function()
            return game:GetObjects(asset)[1]
        end)
        
        if success and result then
            content = { result }
            importCache[asset] = content
            return unpack(content)
        end
    else
        local baseUrl = "https://raw.githubusercontent.com/" .. user .. "/Hyd/" .. branch .. "/"
        
        -- Массив для перебора вариантов (Регистр + Расширение)
        local fixedAsset = asset:gsub("^objects/", "Objects/")
                                :gsub("^methods/", "Methods/")
                                :gsub("^ui/controls/", "ui/Controls/")
                                :gsub("^ui/modules/", "ui/Modules/")
                                :gsub("^modules/", "Modules/")

        local attempts = {
            baseUrl .. fixedAsset .. ".lua",
            baseUrl .. fixedAsset,
            baseUrl .. asset .. ".lua",
            baseUrl .. asset
        }

        local success, result
        for _, url in ipairs(attempts) do
            success, result = pcall(game.HttpGet, game, url)
            if success and result and not (type(result) == "string" and result:find("404")) and #result > 10 then
                break 
            end
        end

        if success and result and not (type(result) == "string" and result:find("404")) then
            local f, err = loadstring(result, asset)
            if f then
                content = { f() }
                importCache[asset] = content
                return unpack(content)
            else
                warn("<OH> Ошибка компиляции модуля " .. asset .. ": " .. err)
            end
        end
    end
    warn("<OH> Не удалось загрузить ассет: " .. asset)
    return nil
end

-- Продвинутый поиск методов инжектора (Адаптация под любые читы)
local globalMethods = {
    checkCaller = checkcaller or check_caller or is_protosmasher_caller,
    newCClosure = newcclosure or new_c_closure,
    hookFunction = hookfunction or detour_function or replaceclosure or hook_function,
    getGc = getgc or get_gc_objects or debug.getgc,
    getInfo = debug.getinfo or getinfo,
    getSenv = getsenv,
    getMenv = getmenv or getsenv,
    getContext = getthreadcontext or get_thread_identity or get_thread_context or (syn and syn.get_thread_identity),
    getConnections = getconnections or get_signal_cons or get_connections,
    getScriptClosure = getscriptclosure or get_script_function or get_script_closure,
    getNamecallMethod = getnamecallmethod or get_namecall_method,
    getCallingScript = getcallingscript or get_calling_script,
    getLoadedModules = getloadedmodules or get_loaded_modules,
    getConstants = debug.getconstants or getconstants or getconsts,
    getUpvalues = debug.getupvalues or getupvalues or getupvals,
    getProtos = debug.getprotos or getprotos,
    getStack = debug.getstack or getstack,
    getConstant = debug.getconstant or getconstant or getconst,
    getUpvalue = debug.getupvalue or getupvalue or getupval,
    getProto = debug.getproto or getproto,
    getMetatable = getrawmetatable or debug.getmetatable,
    getHui = gethui or get_hidden_gui or (function() return game:GetService("CoreGui") end),
    setClipboard = setclipboard or write_clipboard or set_clipboard,
    setConstant = debug.setconstant or setconstant or setconst,
    setContext = setthreadcontext or set_thread_identity or set_thread_context or (syn and syn.set_thread_identity),
    setUpvalue = debug.setupvalue or setupvalue or setupval,
    setStack = debug.setstack or setstack,
    setReadOnly = setreadonly or make_writeable or (make_readonly and function(t, r) if r then make_readonly(t) else make_writeable(t) end end),
    isLClosure = islclosure or is_l_closure or (iscclosure and function(f) return not iscclosure(f) end),
    isReadOnly = isreadonly or is_readonly,
    isXClosure = is_synapse_function or issentinelclosure or is_protosmasher_closure or is_sirhurt_closure or iselectronfunction or istempleclosure or checkclosure,
    readFile = readfile,
    writeFile = writefile,
    makeFolder = makefolder,
    isFolder = isfolder,
    isFile = isfile,
}

-- Специальный "аварийный" хук для MetaMethod (если инжектор его не имеет)
globalMethods.hookMetaMethod = hookmetamethod or hook_metamethod or (function(obj, method, func) 
    local mt = globalMethods.getMetatable(obj)
    if mt and mt[method] then
        return globalMethods.hookFunction(mt[method], func)
    end
end)

-- Создание глобальной таблицы 'oh'
environment.oh = {
    Events = {},
    Hooks = {},
    Cache = importCache,
    Methods = globalMethods,
    Constants = {
        Types = {
            ["nil"] = "rbxassetid://4800232219",
            table = "rbxassetid://4666594276",
            string = "rbxassetid://4666593882",
            number = "rbxassetid://4666593882",
            boolean = "rbxassetid://4666593882",
            userdata = "rbxassetid://4666594723",
            ["function"] = "rbxassetid://4666593447"
        }
    },
    Exit = function()
        for _, event in pairs(oh.Events) do event:Disconnect() end
        local ui = importCache["rbxassetid://11389137937"]
        if ui then unpack(ui):Destroy() end
    end
}

-- Регистрация всех методов в глобальной среде (важно для работы вкладок)
for name, method in pairs(globalMethods) do
    environment[name] = method
end
environment.import = environment.import

-- ПОСЛЕДОВАТЕЛЬНЫЙ ЗАПУСК
import("aux")
import("Methods/string")
import("Methods/table")
import("Methods/userdata")
import("Methods/environment")

-- Загрузка интерфейса
import("ui/Main")
